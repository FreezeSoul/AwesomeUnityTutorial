# 宋朝历史与传说融合ARPG战斗系统设计文档（优化版）

## 一、核心创新机制：天命因果战斗系统

### 1.1 天命者特权机制

**设计理念**：玩家作为"不受天命束缚的穿越者"，拥有打破因果律的特殊能力

1. **因果律打破**
   - **被动触发**：当生命值低于30%时，可打破一次必死局面
   - **效果**：瞬间恢复50%生命，清除所有负面状态，获得3秒无敌
   - **冷却**：每场战斗仅能触发一次，需要特殊道具重置
   - **视觉反馈**：金色光环爆发，时间暂停0.5秒
   - **技术实现**：FateBreakSystem组件，监听生命值临界点

2. **信仰力共鸣**
   - **积累机制**：击败敌人获得信仰力，连击数越高积累越快
   - **释放效果**：消耗信仰力可短暂改变战斗规则
   - **规则改变**：
     * 时间流速：减缓敌人动作50%（持续2秒）
     * 空间扭曲：缩短攻击距离，增加攻击范围（持续3秒）
     * 因果逆转：将最近受到的伤害反弹给攻击者（1次）
   - **技术实现**：FaithPowerSystem组件，动态修改战斗参数

3. **历史名将召唤**
   - **召唤条件**：信仰力满值时可召唤历史名将协助
   - **名将效果**：
     * 岳飞：全体友军攻击力+30%，持续10秒
     * 文天祥：免疫所有控制效果，持续8秒
     * 辛弃疾：下次攻击必定暴击，伤害+100%
     * 李清照：恢复全部内力，武学冷却减半
   - **技术实现**：HistoricalHeroSystem，管理召唤英雄的技能效果

### 1.2 基础战斗机制（简化版）

1. **精简连击系统**
   - 2段轻攻击 + 1段重攻击（易于掌握）
   - 连击窗口1秒，操作容错率高
   - 伤害倍率：100% → 120% → 150%
   - **技术实现**：SimpleComboSystem，降低操作复杂度

2. 重攻击系统
   - 蓄力时间1.2秒（可通过装备减少至0.8秒）
   - 伤害倍率200%（满蓄力250%）
   - 破防效果+50%（无视敌人50%防御）
   - 消耗内力值20点
   - 可打断敌人动作（打断优先级：高）
   - **蓄力机制**：按住攻击键蓄力，松开释放
   - **技术实现**：ChargeAttack组件，使用协程管理蓄力状态

3. 空中攻击
   - 跳跃攻击伤害120%
   - 空中连击最多3段（每段伤害递增10%）
   - 落地攻击范围伤害（3米半径，伤害衰减）
   - 空中攻击不消耗额外内力
   - **空中时间限制**：最多滞空2秒
   - **技术实现**：AerialCombat组件，检测地面距离和滞空时间

### 1.2 闪避格挡系统

1. 闪避机制
   - 闪避距离3米（可通过轻功提升至4.5米）
   - 无敌帧0.2秒（熟练度提升可达0.3秒）
   - 冷却时间1秒（连续闪避冷却递增：1s→1.5s→2s）
   - 消耗内力15点（轻装备-5点，重装备+5点）
   - 完美闪避触发慢动作（0.5秒，敌人攻击前0.1秒内闪避）
   - **方向性闪避**：8个方向，后撤距离+20%
   - **技术实现**：DodgeSystem组件，使用射线检测避免穿墙

2. 格挡系统
   - 格挡减伤70%（盾牌+10%，双手武器-10%）
   - 完美格挡减伤95%（并反弹10%伤害给攻击者）
   - 完美格挡窗口0.3秒（敌人攻击命中前0.3秒内格挡）
   - 格挡消耗内力10点（重攻击格挡消耗20点）
   - 连续格挡效果递减（第2次70%→60%，第3次60%→50%）
   - **格挡角度限制**：前方120度范围内有效
   - **技术实现**：BlockSystem组件，使用角度计算和时间窗口检测

3. 反击机制
   - 完美格挡后可反击（自动进入反击状态）
   - 反击伤害150%（武学熟练度影响：+0-50%）
   - 反击窗口1秒（技能可延长至1.5秒）
   - 反击必定暴击（暴击伤害200%）
   - 反击不消耗内力（但有独立冷却3秒）
   - **连锁反击**：反击成功后可触发第二次反击
   - **技术实现**：CounterAttack组件，状态机管理反击时机

### 1.3 硬直与霸体

1. 硬直系统
   - 受击硬直时间0.3秒（轻攻击）/0.6秒（重攻击）
   - 硬直累积机制：连续受击硬直时间叠加（最多1.5秒）
   - 硬直期间无法行动（但可消耗内力强制取消，消耗30点）
   - 连击可延长硬直时间（每次命中+0.1秒）
   - 部分武学可减少硬直（韧性武学-50%硬直时间）
   - **硬直恢复**：脱离战斗3秒后硬直抗性+50%
   - **技术实现**：StunSystem组件，使用计时器和状态标记

2. 霸体机制
   - 霸体状态免疫硬直和击退
   - 霸体持续时间有限（3-10秒，根据武学/装备）
   - 重攻击可破除霸体（需要连续3次重攻击）
   - 霸体有血量机制（100-500点霸体值）
   - 霸体破除后进入虚弱状态（防御-30%，持续5秒）
   - **霸体等级**：1-3级，高等级霸体需要更强攻击破除
   - **技术实现**：ArmorSystem组件，独立血量条和破除判定

3. 击飞击倒
   - 特定攻击可击飞敌人（重攻击、武学技能）
   - 击飞距离根据伤害计算（伤害/100 = 米数，最大5米）
   - 击倒状态持续2秒（可通过翻滚提前起身）
   - 击倒期间可追击（伤害+25%，但有追击次数限制）
   - 空中敌人受到额外伤害（+30%，重力影响伤害计算）
   - **环境交互**：击飞可造成撞墙额外伤害
   - **技术实现**：KnockbackSystem组件，物理引擎计算轨迹

### 1.4 受击反馈

1. 视觉反馈
   - 受击闪白效果（0.1秒，可在设置中关闭）
   - 血量条变化动画（平滑过渡，0.3秒完成）
   - 伤害数字飞出（颜色编码：白色普通，黄色暴击，红色致命）
   - 屏幕震动效果（强度0-100%可调，持续0.2秒）
   - 粒子特效展示（血液、火花、武学效果）
   - **慢动作效果**：致命一击触发0.3秒慢动作
   - **技术实现**：FeedbackManager组件，统一管理所有反馈效果

2. 音效反馈
   - 武器碰撞音效（金属、木质、武学不同音效）
   - 受击痛苦声音（根据伤害程度调整音调）
   - 暴击特殊音效（更响亮、更尖锐的音效）
   - 环境音效变化（战斗时背景音降低，突出战斗音效）
   - 背景音乐动态调整（战斗激烈度影响音乐节奏）
   - **3D音效**：根据攻击方向播放立体声音效
   - **技术实现**：AudioManager组件，使用音频池和3D音效

3. 手柄震动（支持Xbox和PlayStation手柄）
   - 攻击命中震动（轻攻击轻震，重攻击强震）
   - 受击震动反馈（根据伤害程度调整强度）
   - 震动强度可调节（0-100%，默认70%）
   - 不同攻击不同震动模式（单次、连续、渐强）
   - 特殊技能特殊震动（独特的震动节奏）
   - **震动模式**：轻击、重击、连击、武学各有专属模式
   - **技术实现**：VibrationManager组件，支持多种手柄协议

## 二、武学技能系统设计（精简深化版）

### 2.1 武学技能核心机制

**设计理念**：减少武学数量，增加每个武学的深度和策略性

1. **核心武学体系（共20个核心武学）**
   - **五大门派武学**（每个门派4个武学）
     * 少林武学：防御型（金刚护体、易筋经）
     * 武当武学：平衡型（太极剑法、八卦掌）
     * 峨眉武学：辅助型（治疗法术、增益法术）
     * 华山武学：攻击型（独孤九剑、紫霞神功）
     * 明教武学：特殊型（圣火神功、乾坤大挪移）
   
   - **武学深度设计**
     * 每个武学有3个进阶形态（基础→精通→宗师）
     * 通过使用次数和特定条件解锁进阶
     * 进阶后获得额外效果和组合技能
     * **技术实现**：CoreMartialArtsSystem，管理武学进阶状态

2. **天命武学系统**
   - **特殊武学**：只有作为"天命不受束缚者"才能学会
   - **因果武学**：可以短暂改变因果关系的武学
     * 因果逆转：将敌人即将造成的伤害转为治疗
     * 命运改写：重新掷骰子决定伤害数值
     * 天命庇护：预知敌人下一次攻击并提前闪避
   - **技术实现**：DestinyMartialArtsSystem，实现特殊因果效果

3. **武学组合系统**
   - **门派组合**：不同门派武学的特殊组合效果
     * 少林+武当：金刚太极（防御+反伤）
     * 华山+峨眉：剑气治疗（攻击+续航）
     * 明教+任意：圣火增幅（增强效果）
   - **元素组合**：不同元素武学的反应效果
     * 火风组合：火焰风暴（范围扩大）
     * 水土组合：泥沼陷阱（控制效果）
     * 金木组合：生命吸取（持续回复）
   - **技术实现**：MartialArtsComboSystem，检测和触发组合效果

3. 连携武学（特殊组合武学，16个组合）
   - 门派连携（武学相生相克）
     * 剑法+刀法：剑气刀光（范围5米，伤害300%）
     * 拳法+掌法：内劲外放（回复50%生命+解毒）
     * 枪法+掌法：枪掌合一（持续10秒，每秒50伤害）
     * 刀法+剑法：刀剑合璧（减速50%+破防）
     * **连携条件**：2秒内使用对应武学
     * **技术实现**：ComboMartialArtsDetector监测武学序列
   
   - 武器连携（武器类型组合）
     * 剑+法器：剑气远程（射程10米，穿透3个敌人）
     * 拳套+符咒：元素拳击（每拳附带随机元素）
     * 长枪+阵法：范围突刺（直线8米，宽度2米）
     * 弓箭+毒药：中毒箭矢（中毒持续8秒）
     * **连携条件**：装备对应武器+学会对应武学
     * **技术实现**：WeaponComboSystem检测装备组合

### 2.2 武学技能释放机制

1. 释放条件
   - 内力值消耗（基于武学等级和类型）
     * 低级武学：10-20点（1-15级武学）
     * 中级武学：25-40点（16-30级武学）
     * 高级武学：45-60点（31-45级武学）
     * 终极武学：70-100点（46-50级武学）
     * **内力回复**：每秒回复5点，脱战后每秒10点
     * **技术实现**：ResourceManager组件管理内力消耗和回复
   
   - 冷却时间（可通过装备和武学缩减）
     * 快速武学：3-5秒（基础攻击武学）
     * 常规武学：8-12秒（元素武学）
     * 强力武学：15-20秒（范围武学）
     * 终极武学：30-60秒（大招武学）
     * **全局冷却**：所有武学共享0.5秒全局冷却
     * **技术实现**：CooldownManager组件，使用计时器数组

2. 释放方式
   - 瞬发武学（40%的武学）
     * 按键即释放（响应时间<0.1秒）
     * 无施法时间
     * 可在移动中使用
     * 可被沉默打断
     * **技术实现**：InstantCast组件，立即执行武学效果
   
   - 引导武学（35%的武学）
     * 需要持续施法（进度条显示）
     * 施法时间1-3秒
     * 施法期间移动速度-70%
     * 被攻击会中断（需要承受伤害>当前生命10%）
     * **技术实现**：ChannelingCast组件，使用协程管理施法过程
   
   - 蓄力武学（25%的武学）
     * 按住蓄力增强效果（蓄力条显示）
     * 蓄力时间0.5-2秒
     * 可提前释放（最低30%效果）
     * 满蓄力效果最佳（200%基础效果）
     * **蓄力阶段**：30%→60%→100%→150%→200%
     * **技术实现**：ChargeCast组件，实时计算蓄力倍率

3. 武学衔接
   - 释放方式
     * 指向释放（鼠标指向目标）
     * 区域选择（范围武学预览）
     * 自身施法（以自己为中心）
     * 蓄力释放（按住蓄力）
   
   - 武学衔接
     * 普攻取消（武学可取消普攻后摇）
     * 武学连招（特定武学可无缝连接）
     * 武学联动（武学技能触发连携）
     * 武器切换（切换武器重置部分冷却）

4. 武学升级（每个武学最多5级）
   - 升级条件
     * 武学点消耗（1级1点，5级5点，总计15点/武学）
     * 使用次数要求（每级需要使用50次）
     * 前置武学要求（树状解锁结构）
     * 等级限制（每10级解锁新一层武学）
     * **武学熟练度**：使用次数影响武学效果微调
     * **技术实现**：MartialArtsProgression组件，记录使用数据
   
   - 升级效果（每级提升）
     * 伤害提升15%（1级100%→5级160%）
     * 冷却时间减少10%（最多减少40%）
     * 范围扩大10%（最多扩大40%）
     * 新增特殊效果（3级和5级解锁特殊效果）
     * **技术实现**：MartialArtsScaling组件，动态计算武学数值

## 三、战斗节奏控制

1. 攻击节奏设计
   - 基础攻击节奏
     * 普攻间隔：0.5秒
     * 连击窗口：0.8秒
     * 武学前摇：0.2-0.5秒
     * 武学后摇：0.3-0.6秒
   
   - combo设计
     * 基础连击倍率：1.1x
     * 最大连击加成：2.0x
     * 连击保持时间：5秒
     * 段数衰减规则

2. 战斗流程控制
   - 开场阶段
     * 观察阶段（1-2秒）
     * 试探阶段（3-5秒）
     * 节奏建立（5-8秒）
   
   - 中期战斗
     * 武学交换
     * 资源管理
     * 走位周旋
     * 连击积累

   - 结束阶段
     * 爆发输出
     * 追击处理
     * 收尾武学
     * 战利品收集

3. 打断与反制机制
   - 打断系统
     * 硬直打断
     * 武学打断
     * 霸体击破
     * 架势崩坏
   
   - 反制设计
     * 反击窗口
     * 弹反机制
     * 招架反制
     * 破绽利用

## 四、敌人AI行为设计

1. AI决策模式
   - 基础行为树
     * 待机状态
     * 警戒状态
     * 战斗状态
     * 撤退状态
   
   - 战斗策略
     * 攻击距离判断
     * 招式选择权重
     * 配合行为判定
     * 特殊状态响应

2. 攻击模式设计
   - 基础攻击
     * 普通攻击组合
     * 范围武学释放
     * 追击判定
     * 防御反击
   
   - 特殊攻击
     * 蓄力大招
     * 连携武学
     * 陷阱布置
     * 召唤支援

3. 配合机制
   - 小怪配合
     * 包围战术
     * 远近结合
     * 元素配合
     * 武学联动
   
   - 精英怪特性
     * 指挥增益
     * 战术调度
     * 特殊能力
     * 小怪强化

4. 难度梯度
   - 普通怪物
     * 基础血量：500-1000
     * 攻击力：50-100
     * 防御力：30-60
     * AI复杂度：低
   
   - 精英怪物
     * 基础血量：2000-3000
     * 攻击力：150-200
     * 防御力：80-120
     * AI复杂度：中
   
   - BOSS设计
     * 基础血量：8000-10000
     * 攻击力：300-500
     * 防御力：150-200
     * AI复杂度：高

## 五、武器系统设计

1. 基础武器类型
   - 单手武器
     * 单手剑：灵活快速
     * 单手斧：破防强化
     * 单手锤：击晕效果
     * 短刀：暴击提升
   
   - 双手武器
     * 双手剑：范围伤害
     * 双手斧：高额伤害
     * 双手枪：突刺攻击
     * 长柄武器：距离优势

2. 武器特性设计
   - 基础属性
     * 伤害范围
     * 攻击速度
     * 暴击倍率
     * 元素亲和
   
   - 特殊效果
     * 武器技能
     * 被动加成
     * 元素附魔
     * 连击特效

3. 武器升级系统
   - 强化系统
     * 基础强化（+1到+10）
     * 进阶强化（+11到+15）
     * 完美强化（+16到+20）
     * 特殊强化效果
   
   - 改造系统
     * 属性词条添加
     * 特效改造
     * 外观定制
     * 套装改造

## 六、宋朝文化战斗系统

### 6.1 诗词书法战斗化

**设计理念**：将宋朝文化元素转化为战斗技能和机制

1. **诗词武学**
   - **诗词技能**：通过背诵和吟唱诗词发动特殊效果
     * 《念奴娇·赤壁怀古》：范围伤害 + 敌人减速
     * 《水调歌头·明月几时有》：全体友军治疗 + 暴击率提升
     * 《满江红》：单体巨额伤害 + 攻击力提升
     * 《声声慢》：范围控制 + 持续伤害
   - **诗词连招**：连续使用同一作者的诗词获得加成
     * 苏轼组合：火系伤害 + 灼烧效果
     * 李清照组合：水系治疗 + 冰冻控制
     * 辛弃疾组合：土系防御 + 反伤效果
   - **技术实现**：PoetryMartialArtsSystem，管理诗词技能效果

2. **书法战斗**
   - **笔画技能**：用书法笔画发动攻击
     * 横（一）：直线范围攻击
     * 竖（丨）：突刺攻击，穿透敌人
     * 撇（丿）：弧形攻击，击退效果
     * 捺（㇏）：扇形范围攻击
   - **字体组合**：组合笔画形成完整汉字发动强力技能
     * "火"字：火焰爆炸伤害
     * "水"字：治疗和减速效果
     * "山"字：地形改变，制造障碍
     * "剑"字：强化所有武器攻击
   - **技术实现**：CalligraphyCombatSystem，将书法转化为战斗效果

### 6.2 历史事件战斗再现

1. **著名战役重现**
   - **靖康之变**：特殊关卡，敌人数量激增但防御降低
   - **郾城大捷**：岳飞增益效果，全体友军战斗力提升
   - **采石矶之战**：水战特殊机制，移动和攻击模式改变
   - **技术实现**：HistoricalBattleSystem，管理历史事件特殊效果

2. **文化名人战斗**
   - **文人墨客**：特殊BOSS，使用诗词和书法技能
   - **武将英雄**：可召唤的辅助角色，提供战斗增益
   - **历史人物**：作为NPC提供任务和特殊能力
   - **技术实现**：CulturalFiguresSystem，管理历史人物交互

## 七、伤害计算系统（简化版）

1. 基础伤害公式
```
最终伤害 = (基础伤害 + 附加伤害) * (1 + 增伤系数) * (1 - 减伤系数) * (1 + 暴击伤害) * 文化元素系数
```

2. 伤害系数详解
   - 基础伤害
     * 武器伤害
     * 武学倍率
     * 属性加成
     * 等级差异
   
   - 增伤系数
     * 武学增伤
     * buff加成
     * 特殊状态
     * 连击加成

3. 元素伤害系统
   - 相生相克
     * 相生：伤害1.2倍
     * 相克：伤害1.5倍
     * 同性：伤害0.8倍
     * 中性：伤害1.0倍
   
   - 元素叠加
     * 双重元素
     * 三重元素
     * 元素爆发
     * 特殊反应

4. 防御计算
   - 物理防御
     * 基础减伤
     * 护甲穿透
     * 固定减伤
     * 百分比减伤
   
   - 元素防御
     * 元素抗性
     * 抗性穿透
     * 元素减免
     * 特殊防御
